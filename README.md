# 解説キャプション作成ツール (kaisetu.py) メンテナンス・操作マニュアル

このドキュメントは、書道作品展などで使用する「解説キャプション（名札・釈文・コメントなどが記載された紙）」をPDFで自動作成するツール `kaisetu.py` の操作およびメンテナンス方法について解説したものです。

## 1. ツールの概要

このツールは以下の機能を持っています。
- **入力**: 作品情報や学生情報が記載されたCSVファイル
- **処理**:
    - データの読み込み（UTF-8およびShift-JISに対応）
    - データの自動整形（半角カナの全角化、臨書/創作による項目の自動選択など）
    - レイアウト調整（A4縦書き、特殊な禁則処理、擬似太字化など）
- **出力**: A4サイズのPDFファイル（1ページに2枚分のキャプション配置、または1人1ファイルの個別出力）

## 2. 動作環境・セットアップ

このツールを実行するには、Python環境が必要です。

### 必要なもの
- Python (3.8以降推奨)
- Windows OS (フォントパスがWindows準拠のため)

### インストール手順（初回のみ）
コマンドプロンプトまたはターミナルで以下のコマンドを実行し、必要なライブラリをインストールしてください。

```bash
pip install pandas reportlab
```

また、`tkinter` はPython標準ライブラリとして通常インストールされていますが、もしエラーが出る場合はPythonのインストール時にtcl/tkを含めるようにしてください。

### 必要なフォント
このツールは以下のフォントファイルが `C:\Windows\Fonts\` に存在することを前提としています。
- `HGRGE.TTC` (HGRゴシックE)
- `HGRME.TTC` (HGR明朝E)
- `msmincho.ttc` (MS明朝)

これらがない場合、エラーになります。

## 3. 使い方

1. `kaisetu.py` を実行します。
   ```bash
   python kaisetu.py
   ```
2. ファイル選択ダイアログが表示されるので、用意した**CSVファイル**を選択します。
3. 生成モードの確認（**個別PDF**か**結合PDF**か）が表示されるので選択します。
   - **はい (Yes)**: `nameplate` フォルダが作成され、その中に人数分のPDFが生成されます。
   - **いいえ (No)**: 全てのデータをまとめた1つのPDFファイルを保存します（保存先を指定します）。
4. 処理が完了するとメッセージが表示されます。

## 4. 入力データの仕様 (CSVファイル)

CSVファイルには以下の列が必要です（順不同可）。

| 列名 | 必須 | 説明 |
| :--- | :---: | :--- |
| **氏名** | 〇 | 制作者の名前 |
| **ふりがな** | 〇 | 氏名のふりがな |
| **学部** | △ | 「法学部」など（学年と結合されます） |
| **学年** | △ | 「3年」など（学部と結合されます） |
| **作品形式** | 〇 | 「臨」またはそれ以外（創作）。これで参照する列が変わります。 |
| **作品名（臨書）** | △ | 臨書の場合の作品名 |
| **釈文（臨書）** | △ | 臨書の場合の釈文 |
| **コメント（臨書）** | △ | 臨書の場合のコメント |
| **作品名（創作）** | △ | 創作の場合の作品名 |
| **釈文（創作）** | △ | 創作の場合の釈文 |
| **コメント（創作）** | △ | 創作の場合のコメント |
| **創作の種類** | △ | 創作の場合のサブタイトル（例：「自由作品」など） |
| **作者名** | △ | 臨書の元となった作者名（例：「王羲之」）。「無し」とすると表示されません。 |
| **再提出** | - | 「再提出」と入力されていると、PDFの上部に「再提出」と表示されます。 |

## 5. メンテナンス・修正方法

コード内の定数部分を書き換えることで、大まかな調整が可能です。

### 文字の太さを変えたい場合
コード冒頭の `BOLD_WIDTH_RATIO` を変更してください。数字を大きくすると太く、小さくすると細くなります。
```python
# 例: 少し細くする
BOLD_WIDTH_RATIO = 0.02
```

### 特定の文字が表示されない・フォントを変えたい場合
`SPECIAL_CHARS_FONT_MAP` に追加してください。
```python
SPECIAL_CHARS_FONT_MAP = {
    '嵗': 'MSMincho', # 嵗はMS明朝で表示
    # 追加
    '𠮷': 'MSMincho',
}
```

### 配置（レイアウト）がずれている場合
`COORDINATES` 辞書の中身を修正します。
- `x`, `y`: 表示位置（左下が原点）
- `font_size`: フォントサイズ
- `adjustments`: 文字ごとの微調整設定

例えば、「名前」の位置を右に動かしたい場合は、`'名前'` キーの中の `x` の数値を増やします。

```python
    '名前': {
        'handler': 'name_and_furigana',
        'x': 260, # 250 -> 260 に変更
        ...
```

### エラーが出る場合
1. **CSVの文字コード**: 基本的には自動判定しますが、うまく読み込めない場合は `UTF-8` または `Shift-JIS` で保存し直してください。
2. **フォントエラー**: エラーメッセージに表示されたフォントパスを確認してください。PCによってフォントファイル名が大文字・小文字で異なる場合があります（コード内のパスを修正してください）。

## 6. お問い合わせ
（ここに管理者の連絡先などを記載してください）
